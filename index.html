<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Custom post type by artovenry</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Custom post type</h1>
      <h2 class="project-tagline">Wordpress plugin for custom post type.</h2>
      <a href="https://github.com/artovenry/custom_post_type" class="btn">View on GitHub</a>
      <a href="https://github.com/artovenry/custom_post_type/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/artovenry/custom_post_type/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="custom_post_type" class="anchor" href="#custom_post_type" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>custom_post_type</h1>

<p>Wordpress plugin for custom post type.</p>

<h1>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h1>

<ul>
<li>Create <code>/your_wp_theme_directory/models/SomePostType.php</code>.</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">&lt;</span>?</span>
<span class="pl-s1">  <span class="pl-k">class</span> <span class="pl-en">Event</span> <span class="pl-k">extends</span> <span class="pl-c1">Artovenry\CustomPostType\</span><span class="pl-e">Base</span>{</span>
<span class="pl-s1">    <span class="pl-k">static</span> <span class="pl-smi">$post_type_options</span><span class="pl-k">=</span>[</span>
<span class="pl-s1">      <span class="pl-s"><span class="pl-pds">"</span>label<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span>   <span class="pl-s"><span class="pl-pds">"</span>Our Big Event!<span class="pl-pds">"</span></span>,</span>
<span class="pl-s1">    ];</span>
<span class="pl-s1">    <span class="pl-k">static</span> <span class="pl-smi">$meta_attributes</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">"</span>organization<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>scheduled_on<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>location<span class="pl-pds">"</span></span>];</span>
<span class="pl-s1">    <span class="pl-k">static</span> <span class="pl-smi">$meta_boxes</span><span class="pl-k">=</span> [</span>
<span class="pl-s1">      [<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span>, <span class="pl-s"><span class="pl-pds">"</span>extra<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>label<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Extra Informations<span class="pl-pds">"</span></span>],</span>
<span class="pl-s1">      [<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span>, <span class="pl-s"><span class="pl-pds">"</span>option<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>label<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Options<span class="pl-pds">"</span></span>]</span>
<span class="pl-s1">    ];</span>
<span class="pl-s1">    <span class="pl-k">static</span> <span class="pl-smi">$post_list_options</span><span class="pl-k">=</span>[</span>
<span class="pl-s1">      <span class="pl-s"><span class="pl-pds">"</span>order<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span>[<span class="pl-s"><span class="pl-pds">"</span>organization<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>scheduled_on<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>location<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span>],</span>
<span class="pl-s1">      <span class="pl-s"><span class="pl-pds">"</span>columns<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span>[</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>organization<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span>[<span class="pl-s"><span class="pl-pds">"</span>label<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>],</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>scheduled_on<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span>[<span class="pl-s"><span class="pl-pds">"</span>label<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span><span class="pl-s"><span class="pl-pds">"</span>Scheduled On<span class="pl-pds">"</span></span>,</span>
<span class="pl-s1">          <span class="pl-s"><span class="pl-pds">"</span>render<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span><span class="pl-k">function</span>(<span class="pl-smi">$record</span>){<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>&lt;b style='color:red;'&gt;{<span class="pl-smi">$record</span><span class="pl-k">-&gt;</span><span class="pl-smi">scheduled_on</span>}&lt;/b&gt;<span class="pl-pds">"</span></span>;},</span>
<span class="pl-s1">        ],</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>location<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span>[<span class="pl-s"><span class="pl-pds">"</span>label<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span><span class="pl-s"><span class="pl-pds">"</span>Loc.<span class="pl-pds">"</span></span>]</span>
<span class="pl-s1">      ]</span>
<span class="pl-s1">    ];</span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span><span class="pl-pse"><span class="pl-s1">?</span>&gt;</span></pre></div>

<ul>
<li>Activate this plugin.</li>
</ul>

<div class="highlight highlight-source-shell"><pre>% wp plugin activate custom_post_type</pre></div>

<ul>
<li>That's all! For example, you can just use <code>Event</code> class from template files.</li>
</ul>

<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">section</span>&gt;
  &lt;?foreach(Event::take(5) as $item):?&gt;
    &lt;<span class="pl-ent">article</span>&gt;
      ...
      &lt;<span class="pl-ent">footer</span>&gt;
        &lt;<span class="pl-ent">p</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>organization<span class="pl-pds">"</span></span>&gt;
          Organization: &lt;?= $item-&gt;organization ?&gt;
        &lt;/<span class="pl-ent">p</span>&gt;
      &lt;/<span class="pl-ent">footer</span>&gt;
    &lt;/<span class="pl-ent">article</span>&gt;
&lt;/<span class="pl-ent">section</span>&gt;</pre></div>

<h1>
<a id="feature" class="anchor" href="#feature" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Feature</h1>

<h2>
<a id="simple-and-useful-apis" class="anchor" href="#simple-and-useful-apis" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Simple and useful APIs.</h2>

<p>Retrieve <em>published and latest</em> "event" post and wrap this <code>WP_Post</code> object into <code>Event</code> object.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$event</span><span class="pl-k">=</span> <span class="pl-c1">Event</span><span class="pl-k">::</span>take();</span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$event</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Event</span>; <span class="pl-c">//true</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$event</span><span class="pl-k">-&gt;</span><span class="pl-smi">post</span> <span class="pl-k">instanceof</span> <span class="pl-c1">WP_Post</span>; <span class="pl-c">//true</span></span></pre></div>

<p>Accessing one post's meta attributes(which are persisted into <code>wp_postmeta</code> table), <code>get</code>, <code>set</code>, and <code>delete</code> them (You can simply define themes attributes by declaring static attribute or method named <code>meta_attributes</code>).</p>

<p>Meta attributes are scalar values(boolean, integer, float, string) Non-scalar value, such as arrays, objects and recources cannot assign into meta attributes.</p>

<p>Notice: <code>post_type</code> is automatically guessed and registered into WP from <strong>class name</strong>. For example, class <code>Event</code> will be interpretated to <code>event</code>, class <code>ScheduledEvent</code> will be <code>scheduled_event</code>. <code>post_type</code>'s length  is <strong>limited 20chars</strong>.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$event</span><span class="pl-k">=</span> <span class="pl-c1">Event</span><span class="pl-k">::</span>take();</span>
<span class="pl-s1"><span class="pl-smi">$event</span><span class="pl-k">-&gt;</span>setMeta([</span>
<span class="pl-s1">  <span class="pl-s"><span class="pl-pds">"</span>organization<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Our friends<span class="pl-pds">"</span></span>,</span>
<span class="pl-s1">  <span class="pl-s"><span class="pl-pds">"</span>location<span class="pl-pds">"</span></span>     <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Meiji Jingu<span class="pl-pds">"</span></span></span>
<span class="pl-s1">]);</span>
<span class="pl-s1"><span class="pl-smi">$event</span><span class="pl-k">-&gt;</span>deleteMeta(<span class="pl-s"><span class="pl-pds">"</span>scheduled_on<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$event</span><span class="pl-k">-&gt;</span><span class="pl-smi">Event</span>::take();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$event</span><span class="pl-k">-&gt;</span><span class="pl-smi">location</span>;      <span class="pl-c">// "Meiji Jingu"</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$event</span><span class="pl-k">-&gt;</span><span class="pl-smi">organization</span>;  <span class="pl-c">// "Our friends"</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$event</span><span class="pl-k">-&gt;</span><span class="pl-smi">scheduled_on</span>;  <span class="pl-c">// null</span></span></pre></div>

<p>Notice: We just use WP's build-in postmeta APIs. Unlike general ORM mapper framework, our APIs (<code>setMeta</code>, <code>deleteMeta</code> ,,,) don't effect anything to reciever object, simply call WP's functions.</p>

<h2>
<a id="metabox" class="anchor" href="#metabox" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Metabox</h2>

<p>You can define multiple metaboxes for each custom_post_type classes via static attribute or method named <code>meta_boxes</code>. We basically use <strong>Haml</strong> for rendering engine.</p>

<p>Notice: <code>$meta_boxes</code> and <code>$meta_attributes</code> are independent. You can define <code>$meta_attributes</code> without defining <code>$meta_boxes</code>. Of course, you will need to define <code>$meta_boxes</code> if you want users to edit your meta attributes in WP's edit interface.</p>

<h3>
<a id="simple" class="anchor" href="#simple" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Simple</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">ExamplePostType</span> <span class="pl-k">extends</span> <span class="pl-c1">Artovenry\CustomPost\</span><span class="pl-e">Base</span>{</span>
<span class="pl-s1">  <span class="pl-k">static</span> <span class="pl-smi">$meta_boxes</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span><span class="pl-s"><span class="pl-pds">'</span>options<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">"</span>label<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Please set your options!<span class="pl-pds">"</span></span>];</span>
<span class="pl-s1">  <span class="pl-c">//...</span></span>
<span class="pl-s1">}</span></pre></div>

<p>will render metabox with template (do not forget <code>.html.haml</code> or <code>.php</code> extension) <code>{TEMPLATEPATH}/models/meta_boxes/example_post_type/options.html.haml</code>, or <code>{TEMPLATEPATH}/models/meta_boxes/example_post_type/options.php</code>.</p>

<h3>
<a id="you-can-define-your-own-template-file" class="anchor" href="#you-can-define-your-own-template-file" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>You can define your own template file.</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">  <span class="pl-k">static</span> <span class="pl-smi">$meta_boxes</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span><span class="pl-s"><span class="pl-pds">'</span>options<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">"</span>label<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>OPTS<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>template<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span><span class="pl-s"><span class="pl-pds">"</span>options<span class="pl-pds">"</span></span>];</span></pre></div>

<p>In this case, template file is <code>{TEMPLATEPATH}/meta_boxes/options.html.haml(or .php)</code>.</p>

<h3>
<a id="you-can-dynamically-define-your-rendering-method-by-specifing-its-static-methods-name-or-callable-value" class="anchor" href="#you-can-dynamically-define-your-rendering-method-by-specifing-its-static-methods-name-or-callable-value" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>You can dynamically define your rendering method by specifing its static method's name, or callable value.</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">  <span class="pl-k">static</span> <span class="pl-smi">$meta_boxes</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span><span class="pl-s"><span class="pl-pds">"</span>options<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>render<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span><span class="pl-s"><span class="pl-pds">"</span>render_options_box<span class="pl-pds">"</span></span>];</span>
<span class="pl-s1">  <span class="pl-c">//...</span></span>
<span class="pl-s1">  <span class="pl-k">static</span> <span class="pl-k">function</span> <span class="pl-en">render_options_box</span>(){</span>
<span class="pl-s1">    <span class="pl-c">//outputs your meta box,,,</span></span>
<span class="pl-s1">  }</span>
<span class="pl-s1"></span>
<span class="pl-s1">  <span class="pl-c">//or with callable style...</span></span>
<span class="pl-s1">  <span class="pl-k">static</span> <span class="pl-smi">$meta_boxes</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span><span class="pl-s"><span class="pl-pds">"</span>options<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>render<span class="pl-pds">"</span></span><span class="pl-k">=&gt;</span>[<span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">meta_renderer</span>, <span class="pl-s"><span class="pl-pds">"</span>render<span class="pl-pds">"</span></span>]]</span>
<span class="pl-s1"></span></pre></div>

<h2>
<a id="callback" class="anchor" href="#callback" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Callback</h2>

<p>When saving a post, POSTed <code>meta_attributes</code> will be automatically persisted(<strong>added</strong> or <strong>updated</strong>) into wp_postmeta table(via WP's action hook: <code>save_post</code>), when CSRF authorized. Otherwise, this callback is skipped (meta_attributes <strong>will not persisted</strong>).</p>

<p>Make sure meta attributes which are not POSTed will not be deleted. When you do not prefer orphaned meta attributes, you will need to define your custom callback to destroy them.</p>

<p><strong>$meta_boxes</strong> generates its own csrf token (per meta_box) and render hidden  input field with <code>_art_nonce_{template's name}</code> (eg, <code>_art_nonce_item_price</code>).
CSRF authorization check this token and authorize your POSTed meta_attributes.</p>

<p>You can define two custom callback methods <code>after_save</code> and <code>before_save</code>. <code>after_save</code> is invoked within WP's <code>save_post</code> hook, just after it's POSTed meta_attributes are persisted. <code>before_save</code> is invoked within WP's <code>wp_insert_post_data</code> hook.</p>

<p>Notice: If CSRF authorization failed, <code>after_save</code> callback is canceled.</p>

<p>This will set "updated_at" meta attribute to current UNIX timestamp when updating a post:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">Information</span> <span class="pl-k">extends</span> <span class="pl-c1">Artovenry\CustomPostType\</span><span class="pl-e">Base</span>{</span>
<span class="pl-s1">  <span class="pl-k">static</span> <span class="pl-smi">$meta_atributes</span><span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">"</span>updated_at<span class="pl-pds">"</span></span>];</span>
<span class="pl-s1">  <span class="pl-k">static</span> <span class="pl-k">function</span> <span class="pl-en">after_save</span>(<span class="pl-smi">$post_id</span>, <span class="pl-smi">$post</span>, <span class="pl-smi">$updated</span>){</span>
<span class="pl-s1">    <span class="pl-k">if</span>(<span class="pl-k">!</span><span class="pl-smi">$updated</span>)<span class="pl-k">return</span>;</span>
<span class="pl-s1">    <span class="pl-smi">$post</span><span class="pl-k">-&gt;</span>set_meta(<span class="pl-s"><span class="pl-pds">"</span>updated_at<span class="pl-pds">"</span></span>, <span class="pl-c1">time</span>()); <span class="pl-c">//$post is a instance of Information, not a WP_Post</span></span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<p>This will truncate "post_title" attribute within 20 words before save a post.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">Information</span> <span class="pl-k">extends</span> <span class="pl-c1">Artovenry\CustomPostType\</span><span class="pl-e">Base</span>{</span>
<span class="pl-s1">  <span class="pl-k">static</span> <span class="pl-k">function</span> <span class="pl-en">before_save</span>(<span class="pl-smi">$sanitized</span>, <span class="pl-smi">$raw</span>){</span>
<span class="pl-s1">    <span class="pl-smi">$sanitized</span>[<span class="pl-s"><span class="pl-pds">"</span>post_title<span class="pl-pds">"</span></span>]<span class="pl-k">=</span> wp_trim_words(<span class="pl-smi">$sanitized</span>[<span class="pl-s"><span class="pl-pds">"</span>post_title<span class="pl-pds">"</span></span>], <span class="pl-c1">20</span>);</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$sanitized</span>;  <span class="pl-c">//You must return $sanitized.</span></span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<h2>
<a id="validation" class="anchor" href="#validation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Validation</h2>

<p>We do support <strong>nothing</strong> about it.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/artovenry/custom_post_type">Custom post type</a> is maintained by <a href="https://github.com/artovenry">artovenry</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
